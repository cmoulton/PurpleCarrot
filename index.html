<!DOCTYPE HTML>
 <html lang="en-US">
 <head>
 	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
 	<title>PurpleCarrot</title>
 	<link rel="stylesheet" type="text/css" href="css/desktop-style.css" />
 	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script src="js/leaflet.js"></script>
 </head>
 <body>
 	<div id="wrapper">
 		<div id="header">
 		</div>

 		<div id="body">
			<div id="map" style="width: 100%; height: 600px"></div>
			<script>
				var map = L.map('map').setView([43.6481, -79.4042], 13);
				L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
					maxZoom: 18,
					attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'
				}).addTo(map);
				L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
					attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
				}).addTo(map);
				/*L.marker([43.6481, -79.4042]).addTo(map)
					.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();*/
				L.circle([43.6481, -79.4042], 500, {
					color: 'red',
					fillColor: '#f03',
					fillOpacity: 0.5
				}).addTo(map).bindPopup("I am a circle.");
				/*L.polygon([
					[43.6481, -79.41],
					[43.6485, -79.4],
					[43.66, -79.4042]
				]).addTo(map).bindPopup("I am a polygon.");*/
				var popup = L.popup();
				function onMapClick(e) {
					popup
						.setLatLng(e.latlng)
						.setContent("You clicked the map at " + e.latlng.toString())
						.openOn(map);
						info.update(e);
						myCircle.setLatLng(e.latlng);
						$.each(markers, function(i, item){
						if (Math.abs(item.getLatLng().lat - e.latlng.lat) < 10)
						{
							item.openPopup();
							console.log(item.getLatLng().lat);
						}
				});
				}
				map.on('click', onMapClick);
				var info = L.control();
				info.onAdd = function (map) {
					this._div = L.DomUtil.create('div', 'info');
					this.update();
					return this._div;
				};
				info.update = function (props) {
					console.log(props);
					this._div.innerHTML = '<h4>You clicked at:</h4>' +  (props ?
						'<b>' + props.latlng + '</b>'
						: 'Click somewhere');
				};
				info.addTo(map);

				var myIcon = L.icon({
					iconUrl: 'img/marker-icon',
					iconRetinaUrl: 'img/marker-icon@2x.png',
					iconSize: [25, 41],
					iconAnchor: [22, 94],
					popupAnchor: [-3, -76],
					shadowUrl: 'img/marker-shadow.png',
					shadowRetinaUrl: 'img/marker-shadow@2x.png',
					shadowSize: [21, 21],
					shadowAnchor: [22, 94]
				});

				var markers = new Array();
				$.each(carparks.carparks, function(i,item){
				var aMarker = L.marker([item.lat, item.lng], {icon: myIcon}).addTo(map)
					.bindPopup("<b>"+item.address+"</b><br />" + item.rate).openPopup();
					//console.log(item.rate);
					markers.push(aMarker);
				});
			</script>
 		</div>

 		<div id="footer">
 		</div>
 	</div>
 </body>
 <script type="text/javascript" src="js/jscript.js"></script>
 </html>
